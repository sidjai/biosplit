---
title: "Multi Year comparision"
author: "Siddarta Jairam"
date: "Tuesday, April 9, 2015"
output: 
  word_document:
    reference_docx: AutoReporttemp.docx
---

```{r setup, include=FALSE}
library(knitr)
library(jpeg)
knitr::opts_chunk$set(fig.width=6.5, fig.height=3,fig.pos='center',echo=FALSE,comment='>')
library(ggplot2)
library(grid)
realWd <- 'C:/Users/Siddarta.Jairam/Documents/MothMigrationModel'
load(paste(realWd,"cfg.Rout",sep="/"))
figList <- list()
updateFigList <- function(lst,name){
	lst[[name]] <- length(lst)+1
	return(lst)
}
dispVar <- function(var){
	cat(paste(deparse(substitute(var)),var,sep=' = '),'\n')
}
dispFig <- function(path){
	ras <- readJPEG(path,native=TRUE)
	grid.raster(ras)
}
```

This report will compare these runs:

```{r}
SimDir <- 'C:/Users/Siddarta.Jairam/Documents/Hysplit Out Moth table'
runs <- c('runDataRedo','runHelloWorld','runInterYear','runFLwinter')
years <- c('2011','2012','2013','2014')
#runs <- c('runDataRedo','runHelloWorld')
#years <- c('2011','2012')
rwyear <- paste(years,runs,sep='/')
fullDir <- paste(SimDir,rwyear,sep='/')
numRuns <- length(rwyear)
cat(paste(rwyear,colllapse='|'))
```

The conditions that the run was done in is as follows:

```{r}
condFiles <- vapply(fullDir,function(x){
	readLines(paste(x,'Conditions.txt',sep='/'))
	},rep('one',5))
cat(condFiles[3:4,1])
```

The differences between the diffrent runs are as follows:
```{r}
figList <- updateFigList(figList,"bioDiff")
figList <- updateFigList(figList,"simDiff")
figList <- updateFigList(figList,"jpgTable")

```


```{r}
findDiff <- function(vecvars){
	cond <- strsplit(vecvars,';')
	diff <- matrix('Same values', nrow = 1, ncol = numRuns)
	colnames(diff) <- rwyear
	locCnt <- 1 
	for (var in seq(1,length(cond[[1]]))){
		allCond <- vapply(1:numRuns,function(x)cond[[x]][var],'one')
		test <- allCond %in% cond[[1]][var]
		
			
		if(!min(test)){
			#There is a difference between the runs so output it
			if(grepl("=",allCond[1])){
				parse <- strsplit(allCond,' = ')
				diff <- rbind(diff,vapply(1:numRuns,function(x)parse[[x]][2],'one'))
				nrname <-  parse[1][1]
			} else {
				diff <- rbind(diff,allCond)
				nrname <- paste0("Starting Location",locCnt)
				locCnt <- locCnt+1
			}
			
			#add the rowname from the thing that is different
			exnames <- rownames(diff)
			exnames[length(exnames)] <- nrname
			rownames(diff) <- exnames
			
			#diff <- paste0(diff,paste(allCond,collapse=' != '),'\n')
		}
	}
	if (dim(diff)[1]>1){ 
		diff <- diff[-1,]
	}
	return(diff)
}

bioDiff <- findDiff(condFiles[3,])
simDiff <- findDiff(condFiles[4,])


```

####Table `r figList$bioDiff`. All the differences between the biological Assumptions in these model runs
```{r,results = 'asis'}
kable(as.data.frame(bioDiff),align='c')
```

####Table `r figList$simDiff`. All the differences between the parameters for the HYSPLIT execution between the different runs
```{r,results = 'asis'}
kable(as.data.frame(simDiff),align='c')
```

Here is the ouput:

####Table `r figList$jpgTable`. Contour plots of instaneous snapshots of the Moth population in the different runs at specific times throughout the migration time for FAW throughout late spring to fall.
```{r fig.height=5,fig.show='hold',dpi=800}
#define jpeg table
contours <- list()
#colnames(contours) <- rwyear
times <- c('051','062','073','091')
off <- .1
marl <- .1
marb <- .15
dates <- strftime(strptime(paste0(times,'0'),'%m%d'),'%b\n%d')
par(mar=c(0,0,0,0))
plot(1,xlim=c(0,4+marl),ylim=c(0,4+marb),type="n",bty="n",axes=FALSE)
#fill the table with markdown paths to jpegs
conPaths <- paste(fullDir,'jpeg','Contours',sep='/')
for(idate in 1:4){
	text(x=0,y=4-idate+.55,labels=dates[idate])
	for(irun in seq(1,numRuns)){
		
		potJpegs <- list.files(conPaths[irun],
			pattern=paste0('Moth_',times[idate]),
			full.names = TRUE)
		path <-	potJpegs[!grepl('gsr2',potJpegs)][1]
		name <- strsplit(path,"Moth table")[[1]][2]
		#contours[idate,irun] <- paste0('![](',path,')')
		#contours[idate,irun] <- paste0('<img src=\"',path,'\"/>')
		#contours[idate,irun] <- paste0('\`\`\`{r} dispFig(',path,')\`\`\`')
		rasterImage(readJPEG(path,native=TRUE),
			irun-1+marl,4-idate-off+marb,irun+off+marl,5-idate+marb,
			interpolate = FALSE)
		if (idate==4){
			text(x=irun-.35,y=0,labels=rwyear[irun])
		}
	}
	
}

#kable(contours,align='c')

```
